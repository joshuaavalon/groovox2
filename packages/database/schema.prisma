datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Attachment {
  id          String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  description String
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  movie       Movie[]  @relation("attachment_movie")
  person      Person[] @relation("attachment_person")
  tag         Tag[]    @relation("attachment_tag")

  @@map("attachment")
}

model FlywaySchemaHistory {
  installedRank Int      @id(map: "flyway_schema_history_pk") @map("installed_rank")
  version       String?  @db.VarChar(50)
  description   String   @db.VarChar(200)
  type          String   @db.VarChar(20)
  script        String   @db.VarChar(1000)
  checksum      Int?
  installedBy   String   @map("installed_by") @db.VarChar(100)
  installedOn   DateTime @default(now()) @map("installed_on") @db.Timestamp(6)
  executionTime Int      @map("execution_time")
  success       Boolean

  @@index([success], map: "flyway_schema_history_s_idx")
  @@map("flyway_schema_history")
}

model Language {
  id   String @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name String @unique
  iso  String @unique

  @@map("language")
}

model Movie {
  id            String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name          String       @unique
  nameSort      String       @unique @map("name_sort")
  contentRating String       @map("content_rating")
  airedDate     DateTime?    @map("aired_date") @db.Date
  tagline       String       @unique
  rating        Decimal?     @db.Decimal(3, 1)
  description   String
  createdAt     DateTime     @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime     @default(now()) @map("updated_at") @db.Timestamp(6)
  movieRole     MovieRole[]
  attachment    Attachment[] @relation("attachment_movie")
  tag           Tag[]        @relation("movie_tag")

  @@map("movie")
}

model MovieRole {
  movieId   String   @map("movie_id") @db.Uuid
  personId  String   @map("person_id") @db.Uuid
  roleId    String   @map("role_id") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  movie     Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  person    Person   @relation(fields: [personId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  role      Role     @relation(fields: [roleId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([movieId, personId, roleId])
  @@map("movie_role")
}

model Person {
  id          String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  nameFirst   String       @map("name_first")
  nameMiddle  String       @map("name_middle")
  nameLast    String       @map("name_last")
  nameSort    String       @map("name_sort")
  description String
  birthDate   DateTime?    @map("birth_date") @db.Date
  deathDate   DateTime?    @map("death_date") @db.Date
  sex         String
  createdAt   DateTime     @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime     @default(now()) @map("updated_at") @db.Timestamp(6)
  movieRole   MovieRole[]
  attachment  Attachment[] @relation("attachment_person")
  tag         Tag[]        @relation("person_tag")

  @@map("person")
}

model Role {
  id          String      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name        String      @unique
  description String
  createdAt   DateTime    @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime    @default(now()) @map("updated_at") @db.Timestamp(6)
  movieRole   MovieRole[]

  @@map("role")
}

model Tag {
  id          String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name        String       @unique
  description String
  categoryId  String       @map("category_id") @db.Uuid
  createdAt   DateTime     @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime     @default(now()) @map("updated_at") @db.Timestamp(6)
  tagCategory TagCategory  @relation(fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  attachment  Attachment[] @relation("attachment_tag")
  movie       Movie[]      @relation("movie_tag")
  person      Person[]     @relation("person_tag")

  @@map("tag")
}

model TagCategory {
  id          String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name        String   @unique
  description String
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime @default(now()) @map("updated_at") @db.Timestamp(6)
  tag         Tag[]

  @@map("tag_category")
}

model Version {
  id        BigInt   @id @default(autoincrement())
  name      String
  version   Int
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)

  @@map("version")
}

generator client {
  provider = "prisma-client-js"
}